// Generated by CoffeeScript 1.8.0

/*! Chee 0.0.4 // MIT licence // chee.richplastow.com // Rich Plastow // */

(function() {
  var Chee, DoTest, chees, integerTest, log, lowNaturalTest, lowWholeTest, naturalTest, test, toType, validate, wholeTest,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  chees = [];

  integerTest = {
    toString: function() {
      return 'the integer test';
    },
    test: function(v) {
      return 0 === v % 1 && Infinity !== v && -Infinity !== v;
    }
  };

  naturalTest = {
    toString: function() {
      return 'the natural-number test';
    },
    test: function(v) {
      return 0 === v % 1 && Infinity !== v && -Infinity !== v && v > 0;
    }
  };

  wholeTest = {
    toString: function() {
      return 'the whole-number test';
    },
    test: function(v) {
      return 0 === v % 1 && Infinity !== v && -Infinity !== v && v >= 0;
    }
  };

  lowNaturalTest = {
    toString: function() {
      return 'the low-natural-number test';
    },
    test: function(v) {
      return (100 > v && v > -100) && naturalTest.test(v);
    }
  };

  lowWholeTest = {
    toString: function() {
      return 'the low-whole-number test';
    },
    test: function(v) {
      return (100 > v && v > -100) && wholeTest.test(v);
    }
  };

  log = console.log.bind(console);

  toType = function(x) {
    return {}.toString.call(x).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();
  };

  validate = function(subject, rules) {
    var errors, key, mand, rule, test, type, value, _i, _len;
    if ('object' !== toType(subject)) {
      return ["`subject` is type '" + (toType(subject)) + "' not 'object'"];
    }
    errors = [];
    for (_i = 0, _len = rules.length; _i < _len; _i++) {
      rule = rules[_i];
      key = rule[0], mand = rule[1], type = rule[2], test = rule[3];
      value = subject[key];
      if (void 0 === value) {
        if (mand) {
          errors.push("Key '" + key + "' is mandatory");
        } else {
          continue;
        }
      } else if (type !== toType(value)) {
        errors.push("Key '" + key + "' is type '" + (toType(value)) + "' not '" + type + "'");
      } else if (!test.test(value)) {
        errors.push("Key '" + key + "' fails " + (test.toString()));
      }
    }
    if (errors.length) {
      return errors;
    }
  };

  Chee = (function() {
    var key, rules, _i, _j, _len, _len1, _ref, _ref1;

    Chee.prototype.I = 'Chee';

    Chee.prototype.toString = function() {
      return "[object " + this.I + "]";
    };

    rules = {
      opt: []
    };

    _ref = ['x', 'y', 'z'];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      key = _ref[_i];
      rules.opt.push([key, 0, 'number', lowWholeTest]);
    }

    _ref1 = ['w', 'h', 'd'];
    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
      key = _ref1[_j];
      rules.opt.push([key, 0, 'number', lowNaturalTest]);
    }

    function Chee(opt) {
      var errors;
      if (opt == null) {
        opt = {};
      }
      errors = validate(opt, rules.opt);
      if (errors) {
        throw new Error('Invalid `opt`:\n  ' + errors.join('\n  '));
      }
      this.i = (chees.push(this)) - 1;
      this.x = opt.x || 0;
      this.y = opt.y || 0;
      this.z = opt.z || 0;
      this.w = opt.w || 1;
      this.h = opt.h || 1;
      this.d = opt.d || 1;
    }

    return Chee;

  })();

  window.Chee = Chee;

  DoTest = (function() {
    var invisibles;

    DoTest.prototype.I = 'DoTest';

    DoTest.prototype.toString = function() {
      return "[object " + I + "]";
    };

    DoTest.prototype.jobs = [];

    function DoTest() {
      this["do"] = __bind(this["do"], this);
    }

    DoTest.prototype["do"] = function() {
      var actual, double, expect, job, md, name, result, runner, summary, tallies, _i, _len, _ref;
      md = [];
      tallies = [0, 0];
      double = null;
      _ref = this.jobs;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        job = _ref[_i];
        switch (toType(job)) {
          case 'function':
            double = job(double);
            break;
          case 'string':
            md.push(job);
            break;
          case 'array':
            runner = job[0], name = job[1], expect = job[2], actual = job[3];
            result = runner(expect, actual, double);
            if (!result) {
              md.push("\u2713 " + name + "  ");
              tallies[0]++;
            } else {
              md.push("\u2718 " + name + "  ");
              md.push("    " + result + "  ");
              tallies[1]++;
            }
        }
        summary = "  passed " + tallies[0] + "/" + (tallies[0] + tallies[1]) + " ";
        summary += tallies[1] ? '\u2718' : '\u2714';
      }
      md.unshift('<a href="#end" id="top">\u2b07</a>' + summary);
      md.push('\n<a href="#top" id="end">\u2b06</a>' + summary);
      return md.join('\n');
    };

    DoTest.prototype.section = function(text) {
      return this.jobs.push(("\n\n" + text + "\n-") + (new Array(text.length).join('-')) + '\n');
    };

    DoTest.prototype.custom = function(tests, runner) {
      var i, test, _i, _len;
      for (i = _i = 0, _len = tests.length; _i < _len; i = ++_i) {
        test = tests[i];
        if ('function' === toType(test)) {
          this.jobs.push(test);
        } else {
          this.jobs.push([runner, test, tests[++_i], tests[++_i]]);
        }
      }
      return this.jobs.push('- - -');
    };

    DoTest.prototype.fail = function(result, delivery, expect, types) {
      if (types) {
        result = "" + (invisibles(result)) + " (" + (toType(result)) + ")";
        expect = "" + (invisibles(expect)) + " (" + (toType(expect)) + ")";
      }
      return "" + (invisibles(result)) + "\n    ...was " + delivery + ", but expected...\n    " + (invisibles(expect));
    };

    invisibles = function(value) {
      return value != null ? value.toString().replace(/^\s+|\s+$/g, function(match) {
        return '\u00b7' + (new Array(match.length)).join('\u00b7');
      }) : void 0;
    };

    DoTest.prototype.throws = function(tests) {
      return this.custom(tests, (function(_this) {
        return function(expect, actual, double) {
          var e, error;
          error = false;
          try {
            actual(double);
          } catch (_error) {
            e = _error;
            error = e.message;
          }
          if (!error) {
            return "No exception thrown, expected...\n    " + expect;
          } else if (expect !== error) {
            return _this.fail(error, 'thrown', expect);
          }
        };
      })(this));
    };

    DoTest.prototype.equal = function(tests) {
      return this.custom(tests, (function(_this) {
        return function(expect, actual, double) {
          var e, error, result;
          error = false;
          try {
            result = actual(double);
          } catch (_error) {
            e = _error;
            error = e.message;
          }
          if (error) {
            return "Unexpected exception...\n    " + error;
          } else if (expect !== result) {
            return _this.fail(result, 'returned', expect, result + '' === expect + '');
          }
        };
      })(this));
    };

    DoTest.prototype.is = function(tests) {
      return this.custom(tests, (function(_this) {
        return function(expect, actual, double) {
          var e, error, result;
          error = false;
          try {
            result = actual(double);
          } catch (_error) {
            e = _error;
            error = e.message;
          }
          if (error) {
            return "Unexpected exception...\n    " + error;
          } else if (expect !== toType(result)) {
            return _this.fail("type " + (toType(result)), 'returned', "type " + expect);
          }
        };
      })(this));
    };

    toType = function(x) {
      return {}.toString.call(x).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();
    };

    return DoTest;

  })();

  test = new DoTest;

  window.doTest = test["do"];

  test.section("`Chee` Constructor Usage, No `opt` Argument");

  test.is([
    "Class is a function", 'function', function() {
      return Chee;
    }, function() {
      return new Chee;
    }, "Instance is an object", 'object', function(c) {
      return c;
    }
  ]);

  test.equal([
    "Class has no properties", 0, function(c) {
      return Object.keys(Chee).length;
    }, "Instance has 7 properties", 7, function(c) {
      return Object.keys(c).length;
    }, "Instance `toString()` as expected", '[object Chee]', function(c) {
      return c.toString();
    }, "Index `i` of first `Chee`", 0, function(c) {
      return c.i;
    }, "Index `i` of second `Chee`", 1, function() {
      return (new Chee).i;
    }, "Default position", '0 0 0', function(c) {
      return "" + c.x + " " + c.y + " " + c.z;
    }, "Default size", '1 1 1', function(c) {
      return "" + c.w + " " + c.h + " " + c.d;
    }
  ]);

  test.is([
    "Default position and size are numbers", 'number', function(c) {
      return c.x + c.y + c.z + c.w + c.h + c.d;
    }, "Index `i` is a number", 'number', function(c) {
      return c.i;
    }
  ]);

  test.section("`Chee` Constructor Usage, Position and Size");

  test.equal([
    "Set the position during instantiation", 14, function() {
      var c;
      c = new Chee({
        x: 5,
        y: 0,
        z: 9.0
      });
      return c.x + c.y + c.z;
    }, "Set the size during instantiation", 14, function() {
      var c;
      c = new Chee({
        w: 2,
        h: 4,
        d: 8.0
      });
      return c.w + c.h + c.d;
    }, "Instantiate with some position/size defaults", 8, function() {
      var c;
      c = new Chee({
        x: 2,
        d: 4
      });
      return c.x + c.y + c.z + c.w + c.h + c.d;
    }
  ]);

  test.section("`Chee` Constructor Errors, Invalid `opt` Argument");

  test.throws([
    function() {
      return (new Chee).i;
    }, "`opt` is a number", "Invalid `opt`:\n  `subject` is type 'number' not 'object'", function() {
      return new Chee(1);
    }, "`opt` is a Date object", "Invalid `opt`:\n  `subject` is type 'date' not 'object'", function() {
      return new Chee(new Date);
    }
  ]);

  test.section("`Chee` Constructor Errors, Position and Size");

  test.throws([
    "Instantiated y-position is null", "Invalid `opt`:\n  Key 'y' is type 'null' not 'number'", function() {
      return new Chee({
        x: 4,
        y: null,
        z: 0
      });
    }, "All instantiated positions are invalid", "Invalid `opt`:\n  Key 'x' is type 'string' not 'number'" + "\n  Key 'y' fails the low-whole-number test" + "\n  Key 'z' fails the low-whole-number test", function() {
      return new Chee({
        x: '3',
        y: -54,
        z: 5.1
      });
    }, "Instantiated h-size is zero", "Invalid `opt`:\n  Key 'h' fails the low-natural-number test", function() {
      return new Chee({
        w: 3,
        h: 0,
        d: 1
      });
    }, "All instantiated positions are invalid", "Invalid `opt`:\n  Key 'w' is type 'regexp' not 'number'" + "\n  Key 'h' fails the low-natural-number test" + "\n  Key 'd' fails the low-natural-number test", function() {
      return new Chee({
        w: /3/,
        h: 100,
        d: 5.1
      });
    }
  ]);

  test.section("Invalid Instances Are Not Recorded");

  test.equal([
    "Invalid `Chee` instances were not pushed to `chees`", true, function(currIndex) {
      return currIndex + 1 === (new Chee).i;
    }
  ]);

}).call(this);
